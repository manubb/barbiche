(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Barbiche=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){},{}],2:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up--;up){parts.unshift("..")}}return parts}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){var resolvedPath="",resolvedAbsolute=false;for(var i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if(typeof path!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){continue}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=path.charAt(0)==="/"}resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."};exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash=substr(path,-1)==="/";path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path};exports.isAbsolute=function(path){return path.charAt(0)==="/"};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if(typeof p!=="string"){throw new TypeError("Arguments to path.join must be strings")}return p}).join("/"))};exports.relative=function(from,to){from=exports.resolve(from).substr(1);to=exports.resolve(to).substr(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")};exports.sep="/";exports.delimiter=":";exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.substr(0,dir.length-1)}return root+dir};exports.basename=function(path,ext){var f=splitPath(path)[2];if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length)}return f};exports.extname=function(path){return splitPath(path)[3]};function filter(xs,f){if(xs.filter)return xs.filter(f);var res=[];for(var i=0;i<xs.length;i++){if(f(xs[i],i,xs))res.push(xs[i])}return res}var substr="ab".substr(-1)==="b"?function(str,start,len){return str.substr(start,len)}:function(str,start,len){if(start<0)start=str.length+start;return str.substr(start,len)}}).call(this,require("_process"))},{_process:3}],3:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],4:[function(require,module,exports){(function(process){var parser=function(){var o=function(k,v,o,l){for(o=o||{},l=k.length;l--;o[k[l]]=v);return o},$V0=[1,11],$V1=[1,3],$V2=[1,4],$V3=[1,5],$V4=[1,6],$V5=[1,7],$V6=[1,8],$V7=[1,10],$V8=[1,25],$V9=[1,14],$Va=[1,15],$Vb=[1,16],$Vc=[1,17],$Vd=[1,18],$Ve=[1,19],$Vf=[1,20],$Vg=[1,21],$Vh=[1,22],$Vi=[1,23],$Vj=[1,29],$Vk=[1,26],$Vl=[5,8,9,10,12,13,14,15,16,17,18,19,20,21,22,23,25,26,32],$Vm=[5,8,9,10,13,14,15,16,17,18,19,20,21,22,23,26],$Vn=[8,13],$Vo=[5,8,9,10,13,14,15,16,17,18,26],$Vp=[5,8,9,10,13,14,15,16,17,18,19,20,21,22,26],$Vq=[8,26];var parser={trace:function trace(){},yy:{},symbols_:{error:2,Main:3,SimpleExpression:4,EOF:5,Order:6,ArrayItemList:7,",":8,"--":9,"++":10,Array:11,"[":12,"]":13,":":14,"||":15,"&&":16,"==":17,"!=":18,"<=":19,">=":20,"<":21,">":22,"+":23,"!":24,"(":25,")":26,NUMBER:27,STRING:28,TRUE:29,FALSE:30,Arguments:31,".":32,PropertyName:33,VAR:34,ArgumentList:35,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",8:",",9:"--",10:"++",12:"[",13:"]",14:":",15:"||",16:"&&",17:"==",18:"!=",19:"<=",20:">=",21:"<",22:">",23:"+",24:"!",25:"(",26:")",27:"NUMBER",28:"STRING",29:"TRUE",30:"FALSE",32:".",34:"VAR"},productions_:[0,[3,2],[3,3],[7,1],[7,3],[6,1],[6,1],[11,2],[11,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,2],[4,3],[4,1],[4,1],[4,1],[4,1],[4,2],[4,4],[4,3],[4,1],[4,1],[31,2],[31,3],[35,1],[35,3],[33,1]],performAction:function anonymous(yytext,yyleng,yylineno,yy,yystate,$$,_$){var $0=$$.length-1;switch(yystate){case 1:return $$[$0-1];break;case 2:return order.bind(null,$$[$0-2],$$[$0-1]);break;case 3:case 32:this.$=singleton.bind(null,$$[$0]);break;case 4:case 33:this.$=push.bind(null,$$[$0-2],$$[$0]);break;case 5:this.$="after";break;case 6:this.$="before";break;case 7:case 30:this.$=emptyArray;break;case 8:case 20:case 31:this.$=$$[$0-1];break;case 9:this.$=bbObj.bind(yy,$$[$0-2],$$[$0]);break;case 10:this.$=OR.bind(null,$$[$0-2],$$[$0]);break;case 11:this.$=AND.bind(null,$$[$0-2],$$[$0]);break;case 12:this.$=EQUAL.bind(null,$$[$0-2],$$[$0]);break;case 13:this.$=NOT_EQ.bind(null,$$[$0-2],$$[$0]);break;case 14:this.$=LEQ.bind(null,$$[$0-2],$$[$0]);break;case 15:this.$=GEQ.bind(null,$$[$0-2],$$[$0]);break;case 16:this.$=LESS.bind(null,$$[$0-2],$$[$0]);break;case 17:this.$=GREATER.bind(null,$$[$0-2],$$[$0]);break;case 18:this.$=plus.bind(null,$$[$0-2],$$[$0]);break;case 19:this.$=NOT.bind(null,$$[$0]);break;case 21:this.$=Number.bind(null,yytext);break;case 22:this.$=quoteUnescape.bind(null,yytext);break;case 23:this.$=TRUE;break;case 24:this.$=FALSE;break;case 25:this.$=call.bind(null,$$[$0-1],$$[$0]);break;case 26:this.$=getProperty.bind(null,$$[$0-3],$$[$0-1]);break;case 27:this.$=getProperty.bind(null,$$[$0-2],$$[$0]);break;case 29:this.$=yy.context.resolve.bind(yy.context,yytext);break;case 34:this.$=String.bind(null,yytext);break}},table:[{3:1,4:2,11:9,12:$V0,24:$V1,25:$V2,27:$V3,28:$V4,29:$V5,30:$V6,34:$V7},{1:[3]},{5:[1,12],6:13,9:[1,27],10:[1,28],12:$V8,14:$V9,15:$Va,16:$Vb,17:$Vc,18:$Vd,19:$Ve,20:$Vf,21:$Vg,22:$Vh,23:$Vi,25:$Vj,31:24,32:$Vk},{4:30,11:9,12:$V0,24:$V1,25:$V2,27:$V3,28:$V4,29:$V5,30:$V6,34:$V7},{4:31,11:9,12:$V0,24:$V1,25:$V2,27:$V3,28:$V4,29:$V5,30:$V6,34:$V7},o($Vl,[2,21]),o($Vl,[2,22]),o($Vl,[2,23]),o($Vl,[2,24]),o($Vl,[2,28]),o($Vl,[2,29]),{4:34,7:33,11:9,12:$V0,13:[1,32],24:$V1,25:$V2,27:$V3,28:$V4,29:$V5,30:$V6,34:$V7},{1:[2,1]},{5:[1,35]},{4:36,11:9,12:$V0,24:$V1,25:$V2,27:$V3,28:$V4,29:$V5,30:$V6,34:$V7},{4:37,11:9,12:$V0,24:$V1,25:$V2,27:$V3,28:$V4,29:$V5,30:$V6,34:$V7},{4:38,11:9,12:$V0,24:$V1,25:$V2,27:$V3,28:$V4,29:$V5,30:$V6,34:$V7},{4:39,11:9,12:$V0,24:$V1,25:$V2,27:$V3,28:$V4,29:$V5,30:$V6,34:$V7},{4:40,11:9,12:$V0,24:$V1,25:$V2,27:$V3,28:$V4,29:$V5,30:$V6,34:$V7},{4:41,11:9,12:$V0,24:$V1,25:$V2,27:$V3,28:$V4,29:$V5,30:$V6,34:$V7},{4:42,11:9,12:$V0,24:$V1,25:$V2,27:$V3,28:$V4,29:$V5,30:$V6,34:$V7},{4:43,11:9,12:$V0,24:$V1,25:$V2,27:$V3,28:$V4,29:$V5,30:$V6,34:$V7},{4:44,11:9,12:$V0,24:$V1,25:$V2,27:$V3,28:$V4,29:$V5,30:$V6,34:$V7},{4:45,11:9,12:$V0,24:$V1,25:$V2,27:$V3,28:$V4,29:$V5,30:$V6,34:$V7},o($Vl,[2,25]),{4:46,11:9,12:$V0,24:$V1,25:$V2,27:$V3,28:$V4,29:$V5,30:$V6,34:$V7},{33:47,34:[1,48]},{5:[2,5]},{5:[2,6]},{4:51,11:9,12:$V0,24:$V1,25:$V2,26:[1,49],27:$V3,28:$V4,29:$V5,30:$V6,34:$V7,35:50},o($Vm,[2,19],{31:24,12:$V8,25:$Vj,32:$Vk}),{12:$V8,14:$V9,15:$Va,16:$Vb,17:$Vc,18:$Vd,19:$Ve,20:$Vf,21:$Vg,22:$Vh,23:$Vi,25:$Vj,26:[1,52],31:24,32:$Vk},o($Vl,[2,7]),{8:[1,54],13:[1,53]},o($Vn,[2,3],{31:24,12:$V8,14:$V9,15:$Va,16:$Vb,17:$Vc,18:$Vd,19:$Ve,20:$Vf,21:$Vg,22:$Vh,23:$Vi,25:$Vj,32:$Vk}),{1:[2,2]},o([5,8,9,10,13,14,26],[2,9],{31:24,12:$V8,15:$Va,16:$Vb,17:$Vc,18:$Vd,19:$Ve,20:$Vf,21:$Vg,22:$Vh,23:$Vi,25:$Vj,32:$Vk}),o([5,8,9,10,13,14,15,26],[2,10],{31:24,12:$V8,16:$Vb,17:$Vc,18:$Vd,19:$Ve,20:$Vf,21:$Vg,22:$Vh,23:$Vi,25:$Vj,32:$Vk}),o([5,8,9,10,13,14,15,16,26],[2,11],{31:24,12:$V8,17:$Vc,18:$Vd,19:$Ve,20:$Vf,21:$Vg,22:$Vh,23:$Vi,25:$Vj,32:$Vk}),o($Vo,[2,12],{31:24,12:$V8,19:$Ve,20:$Vf,21:$Vg,22:$Vh,23:$Vi,25:$Vj,32:$Vk}),o($Vo,[2,13],{31:24,12:$V8,19:$Ve,20:$Vf,21:$Vg,22:$Vh,23:$Vi,25:$Vj,32:$Vk}),o($Vp,[2,14],{31:24,12:$V8,23:$Vi,25:$Vj,32:$Vk}),o($Vp,[2,15],{31:24,12:$V8,23:$Vi,25:$Vj,32:$Vk}),o($Vp,[2,16],{31:24,12:$V8,23:$Vi,25:$Vj,32:$Vk}),o($Vp,[2,17],{31:24,12:$V8,23:$Vi,25:$Vj,32:$Vk}),o($Vm,[2,18],{31:24,12:$V8,25:$Vj,32:$Vk}),{12:$V8,13:[1,55],14:$V9,15:$Va,16:$Vb,17:$Vc,18:$Vd,19:$Ve,20:$Vf,21:$Vg,22:$Vh,23:$Vi,25:$Vj,31:24,32:$Vk},o($Vl,[2,27]),o($Vl,[2,34]),o($Vl,[2,30]),{8:[1,57],26:[1,56]},o($Vq,[2,32],{31:24,12:$V8,14:$V9,15:$Va,16:$Vb,17:$Vc,18:$Vd,19:$Ve,20:$Vf,21:$Vg,22:$Vh,23:$Vi,25:$Vj,32:$Vk}),o($Vl,[2,20]),o($Vl,[2,8]),{4:58,11:9,12:$V0,24:$V1,25:$V2,27:$V3,28:$V4,29:$V5,30:$V6,34:$V7},o($Vl,[2,26]),o($Vl,[2,31]),{4:59,11:9,12:$V0,24:$V1,25:$V2,27:$V3,28:$V4,29:$V5,30:$V6,34:$V7},o($Vn,[2,4],{31:24,12:$V8,14:$V9,15:$Va,16:$Vb,17:$Vc,18:$Vd,19:$Ve,20:$Vf,21:$Vg,22:$Vh,23:$Vi,25:$Vj,32:$Vk}),o($Vq,[2,33],{31:24,12:$V8,14:$V9,15:$Va,16:$Vb,17:$Vc,18:$Vd,19:$Ve,20:$Vf,21:$Vg,22:$Vh,23:$Vi,25:$Vj,32:$Vk})],defaultActions:{12:[2,1],27:[2,5],28:[2,6],35:[2,2]},parseError:function parseError(str,hash){if(hash.recoverable){this.trace(str)}else{function _parseError(msg,hash){this.message=msg;this.hash=hash}_parseError.prototype=Error;throw new _parseError(str,hash)}},parse:function parse(input){var self=this,stack=[0],tstack=[],vstack=[null],lstack=[],table=this.table,yytext="",yylineno=0,yyleng=0,recovering=0,TERROR=2,EOF=1;var args=lstack.slice.call(arguments,1);var lexer=Object.create(this.lexer);var sharedState={yy:{}};for(var k in this.yy){if(Object.prototype.hasOwnProperty.call(this.yy,k)){sharedState.yy[k]=this.yy[k]}}lexer.setInput(input,sharedState.yy);sharedState.yy.lexer=lexer;sharedState.yy.parser=this;if(typeof lexer.yylloc=="undefined"){lexer.yylloc={}}var yyloc=lexer.yylloc;lstack.push(yyloc);var ranges=lexer.options&&lexer.options.ranges;if(typeof sharedState.yy.parseError==="function"){this.parseError=sharedState.yy.parseError}else{this.parseError=Object.getPrototypeOf(this).parseError}function popStack(n){stack.length=stack.length-2*n;vstack.length=vstack.length-n;lstack.length=lstack.length-n}_token_stack:var lex=function(){var token;token=lexer.lex()||EOF;if(typeof token!=="number"){token=self.symbols_[token]||token}return token};var symbol,preErrorSymbol,state,action,a,r,yyval={},p,len,newState,expected;while(true){state=stack[stack.length-1];if(this.defaultActions[state]){action=this.defaultActions[state]}else{if(symbol===null||typeof symbol=="undefined"){symbol=lex()}action=table[state]&&table[state][symbol]}if(typeof action==="undefined"||!action.length||!action[0]){var errStr="";expected=[];for(p in table[state]){if(this.terminals_[p]&&p>TERROR){expected.push("'"+this.terminals_[p]+"'")}}if(lexer.showPosition){errStr="Parse error on line "+(yylineno+1)+":\n"+lexer.showPosition()+"\nExpecting "+expected.join(", ")+", got '"+(this.terminals_[symbol]||symbol)+"'"}else{errStr="Parse error on line "+(yylineno+1)+": Unexpected "+(symbol==EOF?"end of input":"'"+(this.terminals_[symbol]||symbol)+"'")}this.parseError(errStr,{text:lexer.match,token:this.terminals_[symbol]||symbol,line:lexer.yylineno,loc:yyloc,expected:expected})}if(action[0]instanceof Array&&action.length>1){throw new Error("Parse Error: multiple actions possible at state: "+state+", token: "+symbol)}switch(action[0]){case 1:stack.push(symbol);vstack.push(lexer.yytext);lstack.push(lexer.yylloc);stack.push(action[1]);symbol=null;if(!preErrorSymbol){yyleng=lexer.yyleng;yytext=lexer.yytext;yylineno=lexer.yylineno;yyloc=lexer.yylloc;if(recovering>0){recovering--}}else{symbol=preErrorSymbol;preErrorSymbol=null}break;case 2:len=this.productions_[action[1]][1];yyval.$=vstack[vstack.length-len];yyval._$={first_line:lstack[lstack.length-(len||1)].first_line,last_line:lstack[lstack.length-1].last_line,first_column:lstack[lstack.length-(len||1)].first_column,last_column:lstack[lstack.length-1].last_column};if(ranges){yyval._$.range=[lstack[lstack.length-(len||1)].range[0],lstack[lstack.length-1].range[1]]}r=this.performAction.apply(yyval,[yytext,yyleng,yylineno,sharedState.yy,action[1],vstack,lstack].concat(args));if(typeof r!=="undefined"){return r}if(len){stack=stack.slice(0,-1*len*2);vstack=vstack.slice(0,-1*len);lstack=lstack.slice(0,-1*len)}stack.push(this.productions_[action[1]][0]);vstack.push(yyval.$);lstack.push(yyval._$);newState=table[stack[stack.length-2]][stack[stack.length-1]];stack.push(newState);break;case 3:return true}}return true}};function quoteUnescape(str){return str.replace(/(\\('|"|\n|\t|\r))/g,function(){return arguments[2]})}function OR(a,b){return a()||b()}function AND(a,b){return a()&&b()}function EQUAL(a,b){return a()==b()}function NOT_EQ(a,b){return a()!=b()}function LEQ(a,b){return a()<=b()}function LESS(a,b){return a()<b()}function GEQ(a,b){return a()>=b()}function GREATER(a,b){return a()>b()}function NOT(a){return!a()}function emptyArray(){return[]}function singleton(a){return[a()]}function push(a,b){var ret=a();ret.push(b());return ret}function getProperty(a,b){var val=a();if(val==null)return;else{var ret=val[b()];if(typeof ret=="function"){return ret.bind(val)}else return ret}}function call(a,b){return a().apply(null,b())}function bbObj(a,b){return new this.bbObj(a(),b())}function plus(a,b){return a()+b()}function order(a,b){var ret=a();ret._order=b;return ret}function TRUE(){return true}function FALSE(){return false}var lexer=function(){var lexer={EOF:1,parseError:function parseError(str,hash){if(this.yy.parser){this.yy.parser.parseError(str,hash)}else{throw new Error(str)}},setInput:function(input,yy){this.yy=yy||this.yy||{};this._input=input;this._more=this._backtrack=this.done=false;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};if(this.options.ranges){this.yylloc.range=[0,0]}this.offset=0;return this},input:function(){var ch=this._input[0];this.yytext+=ch;this.yyleng++;this.offset++;this.match+=ch;this.matched+=ch;var lines=ch.match(/(?:\r\n?|\n).*/g);if(lines){this.yylineno++;this.yylloc.last_line++}else{this.yylloc.last_column++}if(this.options.ranges){this.yylloc.range[1]++}this._input=this._input.slice(1);return ch},unput:function(ch){var len=ch.length;var lines=ch.split(/(?:\r\n?|\n)/g);this._input=ch+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-len);this.offset-=len;var oldLines=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);if(lines.length-1){this.yylineno-=lines.length-1}var r=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:lines?(lines.length===oldLines.length?this.yylloc.first_column:0)+oldLines[oldLines.length-lines.length].length-lines[0].length:this.yylloc.first_column-len};if(this.options.ranges){this.yylloc.range=[r[0],r[0]+this.yyleng-len]}this.yyleng=this.yytext.length;return this},more:function(){this._more=true;return this},reject:function(){if(this.options.backtrack_lexer){this._backtrack=true}else{return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}return this},less:function(n){this.unput(this.match.slice(n))},pastInput:function(){var past=this.matched.substr(0,this.matched.length-this.match.length);return(past.length>20?"...":"")+past.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var next=this.match;if(next.length<20){next+=this._input.substr(0,20-next.length)}return(next.substr(0,20)+(next.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var pre=this.pastInput();var c=new Array(pre.length+1).join("-");return pre+this.upcomingInput()+"\n"+c+"^"},test_match:function(match,indexed_rule){var token,lines,backup;if(this.options.backtrack_lexer){backup={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done};if(this.options.ranges){backup.yylloc.range=this.yylloc.range.slice(0)}}lines=match[0].match(/(?:\r\n?|\n).*/g);if(lines){this.yylineno+=lines.length}this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:lines?lines[lines.length-1].length-lines[lines.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+match[0].length};this.yytext+=match[0];this.match+=match[0];this.matches=match;this.yyleng=this.yytext.length;if(this.options.ranges){this.yylloc.range=[this.offset,this.offset+=this.yyleng]}this._more=false;this._backtrack=false;this._input=this._input.slice(match[0].length);this.matched+=match[0];token=this.performAction.call(this,this.yy,this,indexed_rule,this.conditionStack[this.conditionStack.length-1]);if(this.done&&this._input){this.done=false}if(token){return token}else if(this._backtrack){for(var k in backup){this[k]=backup[k]}return false}return false},next:function(){if(this.done){return this.EOF}if(!this._input){this.done=true}var token,match,tempMatch,index;if(!this._more){this.yytext="";this.match=""}var rules=this._currentRules();for(var i=0;i<rules.length;i++){tempMatch=this._input.match(this.rules[rules[i]]);if(tempMatch&&(!match||tempMatch[0].length>match[0].length)){match=tempMatch;index=i;if(this.options.backtrack_lexer){token=this.test_match(tempMatch,rules[i]);if(token!==false){return token}else if(this._backtrack){match=false;continue}else{return false}}else if(!this.options.flex){break}}}if(match){token=this.test_match(match,rules[index]);if(token!==false){return token}return false}if(this._input===""){return this.EOF}else{return this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}},lex:function lex(){var r=this.next();if(r){return r}else{return this.lex()}},begin:function begin(condition){this.conditionStack.push(condition)},popState:function popState(){var n=this.conditionStack.length-1;if(n>0){return this.conditionStack.pop()}else{return this.conditionStack[0]}},_currentRules:function _currentRules(){if(this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules}else{return this.conditions["INITIAL"].rules}},topState:function topState(n){n=this.conditionStack.length-1-Math.abs(n||0);if(n>=0){return this.conditionStack[n]}else{return"INITIAL"}},pushState:function pushState(condition){this.begin(condition)},stateStackSize:function stateStackSize(){return this.conditionStack.length},options:{},performAction:function anonymous(yy,yy_,$avoiding_name_collisions,YY_START){var YYSTATE=YY_START;switch($avoiding_name_collisions){case 0:break;case 1:return 27;break;case 2:return 15;break;case 3:return 16;break;case 4:return 17;break;case 5:return 18;break;case 6:return 19;break;case 7:return 20;break;case 8:return 21;break;case 9:return 22;break;case 10:return 10;break;case 11:return 9;break;case 12:return 23;break;case 13:return 24;break;case 14:return 25;break;case 15:return 26;break;case 16:return 29;break;case 17:return 30;break;case 18:return 8;break;case 19:return 32;break;case 20:return 12;break;case 21:return 13;break;case 22:return 14;break;case 23:yy_.yytext=yy_.yytext.substr(1,yy_.yyleng-2);return 28;break;case 24:return 34;break;case 25:return 5;break;case 26:return"INVALID";break}},rules:[/^(?:\s+)/,/^(?:(-)?[0-9]+(\.[0-9]+)?\b)/,/^(?:\|\|)/,/^(?:&&)/,/^(?:==)/,/^(?:!=)/,/^(?:<=)/,/^(?:>=)/,/^(?:<)/,/^(?:>)/,/^(?:\+\+)/,/^(?:--)/,/^(?:\+)/,/^(?:!)/,/^(?:\()/,/^(?:\))/,/^(?:true\b)/,/^(?:false\b)/,/^(?:,)/,/^(?:\.)/,/^(?:\[)/,/^(?:\])/,/^(?::)/,/^(?:(("(([^\"\\\n\r]+)|(\\((([\'\"\\bfnrtv])|([^\'\"\\bfnrtv0-9xu]))|((?:[1-7][0-7]{0,2}|[0-7]{2,3}))|([x]{HexDigit}{2})|([u]{HexDigit}{4})))|(\\(\r\n|\r|\n)))*")|('(([^\'\\\n\r]+)|(\\((([\'\"\\bfnrtv])|([^\'\"\\bfnrtv0-9xu]))|((?:[1-7][0-7]{0,2}|[0-7]{2,3}))|([x]{HexDigit}{2})|([u]{HexDigit}{4})))|(\\(\r\n|\r|\n)))*')))/,/^(?:(([$_a-zA-Z])(([$_a-zA-Z])|[0-9])*))/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26],inclusive:true}}};return lexer}();parser.lexer=lexer;function Parser(){this.yy={}}Parser.prototype=parser;parser.Parser=Parser;return new Parser}();if(typeof require!=="undefined"&&typeof exports!=="undefined"){exports.parser=parser;exports.Parser=parser.Parser;exports.parse=function(){return parser.parse.apply(parser,arguments)};exports.main=function commonjsMain(args){if(!args[1]){console.log("Usage: "+args[0]+" FILE");process.exit(1)}var source=require("fs").readFileSync(require("path").normalize(args[1]),"utf8");return exports.parser.parse(source)};if(typeof module!=="undefined"&&require.main===module){exports.main(process.argv.slice(1))}}}).call(this,require("_process"))},{_process:3,fs:1,path:2}],5:[function(require,module,exports){"use strict";var prefix="bb-";var globalAttr="bb-global";var destructive=false;var re;var store={};var context={stack:[]};context.resolve=function(identifier){var m=this.stack.length-1;var value;while(value===undefined&&m>=0){value=this.stack[m][identifier];m--}return value===undefined?window[identifier]:value};context.init=function(arr){this.stack=arr||[]};context.push=function(obj){this.stack.push(obj)};context.pop=function(){return this.stack.pop()};function bbObj(a,b){this.value=a;this.name=b}bbObj.prototype.toString=function(){if(this.value&&this.name!=null)return this.name.toString();else return""};var Parser=require("../parser.js");Parser.parser.yy.context=context;Parser.parser.yy.bbObj=bbObj;function Barbiche(node){if(node instanceof bbObj){var name=node.name;if(store[name])return store[name];else{var t=document.createElement("template");t.innerHTML=node.value;if(name)t.id=name;node=t}}if(typeof node=="string"){if(store[node])return store[node];else node=document.querySelector("#"+node)}if(!(this instanceof Barbiche)){return new Barbiche(node)}if(node){if(node.id)store[node.id]=this;this.closures={};this.node=destructive?node:node.cloneNode(true);this.ready=false}return this}Barbiche.bbObj=bbObj;Barbiche.setPrefix=function(str){prefix=str;globalAttr=str+"global"};Barbiche.setDestructive=function(bool){destructive=bool};Barbiche.setDelimiters=function(arr){var str="{{([^{}]*)}}|{{{([^{}]*)}}}|([^{}]+)";var escaped=arr.map(function(char){return char.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")});re=new RegExp(str.replace(/{|}/g,function(match){if(match=="{")return escaped[0];else return escaped[1]}),"g")};Barbiche.setDelimiters(["{","}"]);Barbiche.clean=function(name){if(name)delete store[name];else{for(var key in store){delete store[key]}}};function addPrefix(str){return prefix+str}var compile_works={};compile_works[Node.ELEMENT_NODE]=function(node,template){if(node.hasAttribute(prefix+"repeat")&&node.nodeName!="TEMPLATE"){if(node.hasAttribute(prefix+"text")||node.hasAttribute(prefix+"html"))node.removeAttribute(prefix+"repeat");else{var wrapper=document.createElement("template");wrapper.setAttribute(prefix+"repeat",node.getAttribute(prefix+"repeat"));node.removeAttribute(prefix+"repeat");["if","alias"].map(addPrefix).forEach(function(attr){if(node.hasAttribute(attr)){wrapper.setAttribute(attr,node.getAttribute(attr));node.removeAttribute(attr)}});node.before(wrapper);wrapper.content.appendChild(node);node=wrapper}}var bbAttrs={};var attrFound=false;["if","alias","text","html","repeat","import","attr","class"].forEach(function(attr){if(node.hasAttribute(prefix+attr)){attrFound=true;var parsed=Parser.parse(node.getAttribute(prefix+attr));bbAttrs[attr]=template._addClosure(parsed);node.removeAttribute(prefix+attr)}});if(attrFound)node.setAttribute(globalAttr,JSON.stringify(bbAttrs));if(node.nodeName=="TEMPLATE"){compile(node.content,template)}else{Array.from(node.childNodes).forEach(function(child){compile(child,template)})}};compile_works[Node.TEXT_NODE]=function(node,template){var value=node.nodeValue;var tokenFound=false;var res;var stack=[];while(res=re.exec(value)){if(res[3]){stack.push({content:res[3],type:"plain"})}else if(res[1]){stack.push({content:res[1],type:"text"});tokenFound=true}else{stack.push({content:res[2],type:"html"});tokenFound=true}}if(tokenFound){function resolve(accu){var exp=accu.join("+");if(exp){var t=document.createElement("template");t.setAttribute(prefix+"text",exp);node.before(t);compile(t,template)}}resolve(stack.reduce(function(accu,item){if(item.type=="plain"){accu.push('"'+item.content.replace(/('|"|\n|\t|\r)/g,function(){return"\\"+arguments[1]})+'"');return accu}else if(item.type=="text"){accu.push("("+item.content+")");return accu}else{resolve(accu);var t=document.createElement("template");t.setAttribute(prefix+"html",item.content);node.before(t);compile(t,template);return[]}},[]));node.remove()}};compile_works[Node.COMMENT_NODE]=function(node,template){};compile_works[Node.DOCUMENT_FRAGMENT_NODE]=function(node,template){Array.from(node.childNodes).forEach(function(child){compile(child,template)})};Barbiche.prototype._addClosure=function(){var counter=0;return function(fun){counter++;var str="fun"+counter;this.closures[str]=fun;return str}}();Barbiche.prototype._compile=function(){compile(this.node.content,this);this.ready=true;return this};function compile(node,template){compile_works[node.nodeType](node,template)}Barbiche.prototype._clone=function(){if(!this.ready)this._compile();var t=new Barbiche;t.node=this.node.cloneNode(true);t.closures=this.closures;return t};Barbiche.prototype.merge=function(){var clone=this._clone();context.init(Array.from(arguments));merge(clone.node.content,clone);context.init();return clone.node.content};var works={};works[Node.ELEMENT_NODE]=function(node,template){var nodeContext={};var nodeContextPushed=false;var bbAttrs;if(node.hasAttribute(globalAttr)){bbAttrs=JSON.parse(node.getAttribute(globalAttr));node.removeAttribute(globalAttr)}bbAttrs=bbAttrs||{};if(bbAttrs.if){var value=template.closures[bbAttrs.if]();if(!value)return node.remove()}if(bbAttrs.alias){var parsed=template.closures[bbAttrs.alias]();if(!Array.isArray(parsed))parsed=[parsed];parsed.forEach(function(item){nodeContext[item.name]=item.value});context.push(nodeContext);nodeContextPushed=true}if(bbAttrs.text){var value=template.closures[bbAttrs.text]();if(value!=null)value=value.toString();if(value){node.replaceWith(value)}else node.remove()}else if(bbAttrs.html){var value=template.closures[bbAttrs.html]();if(value!=null)value=value.toString();if(value){var template=document.createElement("template");template.innerHTML=value;node.replaceWith(template.content)}else node.remove()}else if(node.nodeName=="TEMPLATE"){if(bbAttrs.repeat){if(!nodeContextPushed){context.push(nodeContext);nodeContextPushed=true}var parsed=template.closures[bbAttrs.repeat]();var order=parsed._order||"before";if(!Array.isArray(parsed))parsed=[parsed];var reduceInit=function(str){var closure=template.closures[bbAttrs.import];if(closure)return function(){var clone=Barbiche(closure())._clone();node[order](merge(clone.node.content,clone))};else return function(){node[order](merge(node.cloneNode(true).content,template))}}(bbAttrs.import);parsed.reduceRight(function(accu,task){var alias=task.name;var value=task.value;return function(){value.forEach(function(item,index){nodeContext[alias]=value[index];nodeContext["_"+alias+"_"]=index;accu()})}},reduceInit)()}else if(bbAttrs.import){var importId=template.closures[bbAttrs.import]();var clone=Barbiche(importId)._clone();node.before(merge(clone.node.content,clone))}else{node.before(merge(node.content,template))}node.remove()}else{if(bbAttrs.attr){var parsed=template.closures[bbAttrs.attr]();if(!Array.isArray(parsed))parsed=[parsed];
parsed.forEach(function(item){var value=item.value;var name=item.name&&item.name.toString();if(name&&value!=null)node.setAttribute(name,value)})}if(bbAttrs.class){var parsed=template.closures[bbAttrs.class]();if(!Array.isArray(parsed))parsed=[parsed];parsed.forEach(function(item){if(item!=null){var value=item.toString();if(value)node.classList.add(value)}})}Array.from(node.children).forEach(function(child){merge(child,template)})}if(nodeContextPushed)context.pop()};works[Node.TEXT_NODE]=function(node,template){};works[Node.COMMENT_NODE]=function(node,template){};works[Node.DOCUMENT_FRAGMENT_NODE]=function(node,template){Array.from(node.children||node.childNodes).forEach(function(child){merge(child,template)})};function merge(node,template){works[node.nodeType](node,template);return node}module.exports=Barbiche},{"../parser.js":4}]},{},[5])(5)});
