(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Barbiche=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var parser=function(){function JisonParserError(msg,hash){Object.defineProperty(this,"name",{enumerable:false,writable:false,value:"JisonParserError"});if(msg==null)msg="???";Object.defineProperty(this,"message",{enumerable:false,writable:true,value:msg});this.hash=hash;var stacktrace;if(hash&&hash.exception instanceof Error){var ex2=hash.exception;this.message=ex2.message||msg;stacktrace=ex2.stack}if(!stacktrace){if(Error.hasOwnProperty("captureStackTrace")){Error.captureStackTrace(this,this.constructor)}else{stacktrace=new Error(msg).stack}}if(stacktrace){Object.defineProperty(this,"stack",{enumerable:false,writable:false,value:stacktrace})}}if(typeof Object.setPrototypeOf==="function"){Object.setPrototypeOf(JisonParserError.prototype,Error.prototype)}else{JisonParserError.prototype=Object.create(Error.prototype)}JisonParserError.prototype.constructor=JisonParserError;JisonParserError.prototype.name="JisonParserError";function bp(s){var rv=[];var p=s.pop;var r=s.rule;for(var i=0,l=p.length;i<l;i++){rv.push([p[i],r[i]])}return rv}function bda(s){var rv={};var d=s.idx;var g=s.goto;for(var i=0,l=d.length;i<l;i++){var j=d[i];rv[j]=g[i]}return rv}function bt(s){var rv=[];var d=s.len;var y=s.symbol;var t=s.type;var a=s.state;var m=s.mode;var g=s.goto;for(var i=0,l=d.length;i<l;i++){var n=d[i];var q={};for(var j=0;j<n;j++){var z=y.shift();switch(t.shift()){case 2:q[z]=[m.shift(),g.shift()];break;case 0:q[z]=a.shift();break;default:q[z]=[3]}}rv.push(q)}return rv}function s(c,l,a){a=a||0;for(var i=0;i<l;i++){this.push(c);c+=a}}function c(i,l){i=this.length-i;for(l+=i;i<l;i++){this.push(this[i])}}function u(a){var rv=[];for(var i=0,l=a.length;i<l;i++){var e=a[i];if(typeof e==="function"){i++;e.apply(rv,a[i])}else{rv.push(e)}}return rv}var parser={trace:function no_op_trace(){},JisonParserError:JisonParserError,yy:{},options:{type:"lalr",errorRecoveryTokenDiscardCount:3},symbols_:{"!":10,"!=":19,$accept:0,$end:1,"&&":17,"(":11,")":12,"+":9,"++":15,",":3,"--":14,".":13,":":6,"<":7,"<=":20,"==":18,">":8,">=":21,ArgumentList:33,Arguments:32,Array:30,ArrayItemList:28,EOF:1,FALSE:25,Main:27,NUMBER:22,Order:29,PropertyName:34,STRING:23,SimpleExpression:31,TRUE:24,VAR:26,"[":4,"]":5,error:2,"||":16},terminals_:{1:"EOF",2:"error",3:",",4:"[",5:"]",6:":",7:"<",8:">",9:"+",10:"!",11:"(",12:")",13:".",14:"--",15:"++",16:"||",17:"&&",18:"==",19:"!=",20:"<=",21:">=",22:"NUMBER",23:"STRING",24:"TRUE",25:"FALSE",26:"VAR"},TERROR:2,EOF:1,originalQuoteName:null,originalParseError:null,cleanupAfterParse:null,constructParseErrorInfo:null,__reentrant_call_depth:0,__error_infos:[],quoteName:function parser_quoteName(id_str){return'"'+id_str+'"'},describeSymbol:function parser_describeSymbol(symbol){if(symbol!==this.EOF&&this.terminal_descriptions_&&this.terminal_descriptions_[symbol]){return this.terminal_descriptions_[symbol]}else if(symbol===this.EOF){return"end of input"}else if(this.terminals_[symbol]){return this.quoteName(this.terminals_[symbol])}var s=this.symbols_;for(var key in s){if(s[key]===symbol){return key}}return null},collect_expected_token_set:function parser_collect_expected_token_set(state,do_not_describe){var TERROR=this.TERROR;var tokenset=[];var check={};if(!do_not_describe&&this.state_descriptions_&&this.state_descriptions_[state]){return[this.state_descriptions_[state]]}for(var p in this.table[state]){p=+p;if(p!==TERROR){var d=do_not_describe?p:this.describeSymbol(p);if(d&&!check[d]){tokenset.push(d);check[d]=true}}}return tokenset},productions_:bp({pop:u([27,27,28,28,29,29,30,30,s,[31,21],32,32,33,33,34]),rule:u([2,3,1,3,1,1,2,s,[3,11],c,[18,3],s,[1,3],2,4,c,[23,5],c,[29,3]])}),performAction:function parser__PerformAction(yytext,yystate,$0,yyvstack){var yy=this.yy;switch(yystate){case 1:return yyvstack[$0-1];break;case 2:return order.bind(null,yyvstack[$0-2],yyvstack[$0-1]);break;case 3:case 32:this.$=singleton.bind(null,yyvstack[$0]);break;case 4:case 33:this.$=push.bind(null,yyvstack[$0-2],yyvstack[$0]);break;case 5:this.$="after";break;case 6:this.$="before";break;case 7:case 30:this.$=emptyArray;break;case 8:case 20:case 31:this.$=yyvstack[$0-1];break;case 9:this.$=bbObj.bind(yy,yyvstack[$0-2],yyvstack[$0]);break;case 10:this.$=OR.bind(null,yyvstack[$0-2],yyvstack[$0]);break;case 11:this.$=AND.bind(null,yyvstack[$0-2],yyvstack[$0]);break;case 12:this.$=EQUAL.bind(null,yyvstack[$0-2],yyvstack[$0]);break;case 13:this.$=NOT_EQ.bind(null,yyvstack[$0-2],yyvstack[$0]);break;case 14:this.$=LEQ.bind(null,yyvstack[$0-2],yyvstack[$0]);break;case 15:this.$=GEQ.bind(null,yyvstack[$0-2],yyvstack[$0]);break;case 16:this.$=LESS.bind(null,yyvstack[$0-2],yyvstack[$0]);break;case 17:this.$=GREATER.bind(null,yyvstack[$0-2],yyvstack[$0]);break;case 18:this.$=plus.bind(null,yyvstack[$0-2],yyvstack[$0]);break;case 19:this.$=NOT.bind(null,yyvstack[$0]);break;case 21:this.$=Number.bind(null,yytext);break;case 22:this.$=quoteUnescape.bind(null,yytext);break;case 23:this.$=TRUE;break;case 24:this.$=FALSE;break;case 25:this.$=call.bind(null,yyvstack[$0-1],yyvstack[$0]);break;case 26:this.$=getProperty.bind(null,yyvstack[$0-3],yyvstack[$0-1]);break;case 27:this.$=getProperty.bind(null,yyvstack[$0-2],yyvstack[$0]);break;case 28:this.$=yyvstack[$0];break;case 29:this.$=yy.context.resolve.bind(yy.context,yytext);break;case 34:this.$=String.bind(null,yytext);break}},table:bt({len:u([11,1,18,10,10,s,[0,6],12,0,1,s,[10,10],0,10,2,c,[18,3],20,15,0,2,16,0,s,[20,10],15,s,[0,3],c,[17,3],0,c,[50,3],10,16,16]),symbol:u([4,10,11,s,[22,6,1],30,31,1,1,4,s,[6,4,1],11,s,[13,9,1],29,32,c,[30,8],30,31,c,[10,11],5,c,[11,7],28,c,[51,3],c,[33,21],c,[10,89],26,34,c,[12,3],12,c,[13,7],33,1,s,[3,7,1],s,[11,11,1],32,c,[194,6],12,13,c,[15,7],3,5,c,[36,8],c,[18,8],c,[53,20],c,[20,180],c,[215,15],3,12,3,c,[251,15],c,[320,20],c,[269,16],c,[52,16]]),type:u([s,[2,8],s,[0,3],1,s,[2,16],0,0,c,[10,28],c,[51,4],c,[43,39],c,[10,73],c,[125,22],c,[178,11],c,[15,29],c,[18,21],c,[20,197],c,[233,27],c,[443,21],c,[54,22],0]),state:u([1,9,2,13,24,9,30,9,31,33,9,34,9,36,9,37,9,38,9,39,9,40,9,41,9,42,9,43,9,44,9,45,9,46,47,9,51,50,s,[24,15],9,58,9,59,24,24]),mode:u([s,[1,148],2,2,c,[3,3],s,[2,3],1,c,[8,7],c,[11,4],c,[35,16],c,[28,3],c,[50,16],c,[24,7],c,[25,7],c,[19,13],c,[20,6],c,[19,14],c,[10,6],c,[19,14],c,[12,4],c,[19,24],c,[9,5],c,[145,9],c,[19,64],c,[221,30],c,[7,12],c,[287,18],c,[252,15],c,[46,14]]),goto:u([11,s,[3,6,1],10,12,25,14,21,22,23,29,26,27,28,s,[15,6,1],c,[24,8],c,[8,9],32,c,[9,7],35,c,[26,17],c,[8,71],48,c,[9,3],49,c,[10,5],19,19,25,s,[19,5],29,19,26,s,[19,8],c,[158,6],52,26,c,[157,6],54,53,3,25,3,c,[176,6],c,[17,6],9,9,25,9,9,c,[16,4],9,26,9,9,c,[19,6],10,10,25,10,10,c,[19,4],10,26,s,[10,3],c,[212,6],11,25,11,11,c,[19,4],11,26,s,[11,4],c,[19,4],12,12,25,12,12,c,[19,4],12,26,s,[12,6],19,20,13,13,25,13,13,c,[19,4],13,26,s,[13,6],19,20,14,14,25,s,[14,4],23,29,14,26,s,[14,8],15,15,25,s,[15,4],23,29,15,26,s,[15,8],16,16,25,s,[16,4],23,29,16,26,s,[16,8],17,17,25,s,[17,4],23,29,17,26,s,[17,8],18,18,25,s,[18,5],29,18,26,s,[18,8],25,55,c,[204,12],57,56,32,c,[238,6],32,c,[17,7],c,[297,16],4,25,4,c,[48,12],33,c,[46,6],33,c,[15,7]])}),defaultActions:bda({idx:u([s,[5,6,1],12,24,27,28,32,35,47,48,49,52,53,55,56]),goto:u([s,[21,4,1],28,29,1,25,5,6,7,2,27,34,30,20,8,26,31])}),parseError:function parseError(str,hash){if(hash.recoverable){this.trace(str);hash.destroy()}else{throw new this.JisonParserError(str,hash)}},parse:function parse(input){var self=this,stack=new Array(128),sstack=new Array(128),vstack=new Array(128),table=this.table,sp=0;var TERROR=this.TERROR,EOF=this.EOF,ERROR_RECOVERY_TOKEN_DISCARD_COUNT=this.options.errorRecoveryTokenDiscardCount|0||3;var NO_ACTION=[0,table.length];var lexer;if(this.__lexer__){lexer=this.__lexer__}else{lexer=this.__lexer__=Object.create(this.lexer)}var sharedState_yy={parseError:null,quoteName:null,lexer:null,parser:null,pre_parse:null,post_parse:null};for(var k in this.yy){if(Object.prototype.hasOwnProperty.call(this.yy,k)){sharedState_yy[k]=this.yy[k]}}sharedState_yy.lexer=lexer;sharedState_yy.parser=this;lexer.setInput(input,sharedState_yy);vstack[sp]=null;sstack[sp]=0;stack[sp]=0;++sp;if(typeof lexer.yytext==="undefined"){lexer.yytext=""}var yytext=lexer.yytext;if(typeof lexer.yylineno==="undefined"){lexer.yylineno=0}if(typeof sharedState_yy.parseError==="function"){this.parseError=sharedState_yy.parseError}else{this.parseError=this.originalParseError}if(typeof sharedState_yy.quoteName==="function"){this.quoteName=sharedState_yy.quoteName}else{this.quoteName=this.originalQuoteName}this.cleanupAfterParse=function parser_cleanupAfterParse(resultValue,invoke_post_methods,do_not_nuke_errorinfos){var rv;if(invoke_post_methods){if(sharedState_yy.post_parse){rv=sharedState_yy.post_parse.call(this,sharedState_yy,resultValue);if(typeof rv!=="undefined")resultValue=rv}if(this.post_parse){rv=this.post_parse.call(this,sharedState_yy,resultValue);if(typeof rv!=="undefined")resultValue=rv}}if(this.__reentrant_call_depth>1)return resultValue;if(lexer.cleanupAfterLex){lexer.cleanupAfterLex(do_not_nuke_errorinfos)}if(sharedState_yy){sharedState_yy.parseError=undefined;sharedState_yy.quoteName=undefined;sharedState_yy.lexer=undefined;sharedState_yy.parser=undefined;if(lexer.yy===sharedState_yy){lexer.yy=undefined}}sharedState_yy=undefined;this.parseError=this.originalParseError;this.quoteName=this.originalQuoteName;stack.length=0;sstack.length=0;vstack.length=0;stack_pointer=0;if(!do_not_nuke_errorinfos){for(var i=this.__error_infos.length-1;i>=0;i--){var el=this.__error_infos[i];if(el&&typeof el.destroy==="function"){el.destroy()}}this.__error_infos.length=0}return resultValue};this.constructParseErrorInfo=function parser_constructParseErrorInfo(msg,ex,expected,recoverable){var pei={errStr:msg,exception:ex,text:lexer.match,value:lexer.yytext,token:this.describeSymbol(symbol)||symbol,token_id:symbol,line:lexer.yylineno,expected:expected,recoverable:recoverable,state:state,action:action,new_state:newState,symbol_stack:stack,state_stack:sstack,value_stack:vstack,stack_pointer:sp,yy:sharedState_yy,lexer:lexer,parser:this,destroy:function destructParseErrorInfo(){var rec=!!this.recoverable;for(var key in this){if(this.hasOwnProperty(key)&&typeof key==="object"){this[key]=undefined}}this.recoverable=rec}};this.__error_infos.push(pei);return pei};function lex(){var token=lexer.lex();if(typeof token!=="number"){token=self.symbols_[token]||token}return token||EOF}var symbol=0;var state,action,r,t;var yyval={$:true,_$:undefined,yy:sharedState_yy};var p,len,this_production;var newState;var retval=false;try{this.__reentrant_call_depth++;if(this.pre_parse){this.pre_parse.call(this,sharedState_yy)}if(sharedState_yy.pre_parse){sharedState_yy.pre_parse.call(this,sharedState_yy)}newState=sstack[sp-1];for(;;){state=newState;if(this.defaultActions[state]){action=2;newState=this.defaultActions[state]}else{if(!symbol){symbol=lex()}t=table[state]&&table[state][symbol]||NO_ACTION;newState=t[1];action=t[0];if(!action){var errStr;var errSymbolDescr=this.describeSymbol(symbol)||symbol;var expected=this.collect_expected_token_set(state);if(lexer.showPosition){errStr="Parse error on line "+(lexer.yylineno+1)+":\n"+lexer.showPosition()+"\n"}else{errStr="Parse error on line "+(lexer.yylineno+1)+": "}if(expected.length){errStr+="Expecting "+expected.join(", ")+", got unexpected "+errSymbolDescr}else{errStr+="Unexpected "+errSymbolDescr}p=this.constructParseErrorInfo(errStr,null,expected,false);retval=this.parseError(p.errStr,p);break}}switch(action){default:if(action instanceof Array){p=this.constructParseErrorInfo("Parse Error: multiple actions possible at state: "+state+", token: "+symbol,null,null,false);retval=this.parseError(p.errStr,p);break}p=this.constructParseErrorInfo("Parsing halted. No viable error recovery approach available due to internal system failure.",null,null,false);retval=this.parseError(p.errStr,p);break;case 1:stack[sp]=symbol;vstack[sp]=lexer.yytext;sstack[sp]=newState;++sp;symbol=0;yytext=lexer.yytext;continue;case 2:this_production=this.productions_[newState-1];len=this_production[1];vstack[sp]=undefined;r=this.performAction.call(yyval,yytext,newState,sp-1,vstack);if(typeof r!=="undefined"){retval=r;break}sp-=len;var ntsymbol=this_production[0];stack[sp]=ntsymbol;vstack[sp]=yyval.$;newState=table[sstack[sp-1]][ntsymbol];sstack[sp]=newState;++sp;continue;case 3:retval=true;if(typeof yyval.$!=="undefined"){retval=yyval.$}break}break}}catch(ex){p=this.constructParseErrorInfo("Parsing aborted due to exception.",ex,null,false);retval=this.parseError(p.errStr,p)}finally{retval=this.cleanupAfterParse(retval,true,true);this.__reentrant_call_depth--}return retval}};parser.originalParseError=parser.parseError;parser.originalQuoteName=parser.quoteName;var table={n:"\n","'":"'",'"':'"',t:"\t",r:"\r","\\":"\\"};function quoteUnescape(str){return str.replace(/(\\(\\|'|"|r|n|t))/g,function(){return table[arguments[2]]})}function OR(a,b){return a()||b()}function AND(a,b){return a()&&b()}function EQUAL(a,b){return a()==b()}function NOT_EQ(a,b){return a()!=b()}function LEQ(a,b){return a()<=b()}function LESS(a,b){return a()<b()}function GEQ(a,b){return a()>=b()}function GREATER(a,b){return a()>b()}function NOT(a){return!a()}function emptyArray(){return[]}function singleton(a){return[a()]}function push(a,b){var ret=a();ret.push(b());return ret}function getProperty(a,b){var val=a();if(val==null)return;else{var ret=val[b()];if(typeof ret=="function"){return ret.bind(val)}else return ret}}function call(a,b){return a().apply(null,b())}function bbObj(a,b){return new this.bbObj(a(),b())}function plus(a,b){return a()+b()}function order(a,b){var ret=a();ret._order=b;return ret}function TRUE(){return true}function FALSE(){return false}var lexer=function(){function JisonLexerError(msg,hash){Object.defineProperty(this,"name",{enumerable:false,writable:false,value:"JisonLexerError"});if(msg==null)msg="???";Object.defineProperty(this,"message",{enumerable:false,writable:true,value:msg});this.hash=hash;var stacktrace;if(hash&&hash.exception instanceof Error){var ex2=hash.exception;this.message=ex2.message||msg;stacktrace=ex2.stack}if(!stacktrace){if(Error.hasOwnProperty("captureStackTrace")){Error.captureStackTrace(this,this.constructor)}else{stacktrace=new Error(msg).stack}}if(stacktrace){Object.defineProperty(this,"stack",{enumerable:false,writable:false,value:stacktrace})}}if(typeof Object.setPrototypeOf==="function"){Object.setPrototypeOf(JisonLexerError.prototype,Error.prototype)}else{JisonLexerError.prototype=Object.create(Error.prototype)}JisonLexerError.prototype.constructor=JisonLexerError;JisonLexerError.prototype.name="JisonLexerError";var lexer={EOF:1,ERROR:2,__currentRuleSet__:null,__error_infos:[],__decompressed:false,done:false,_backtrack:false,_input:"",_more:false,_signaled_error_token:false,conditionStack:[],match:"",matched:"",matches:false,yytext:"",offset:0,yyleng:0,yylineno:0,yylloc:null,constructLexErrorInfo:function lexer_constructLexErrorInfo(msg,recoverable){var pei={errStr:msg,recoverable:!!recoverable,text:this.match,token:null,line:this.yylineno,loc:this.yylloc,yy:this.yy,lexer:this,destroy:function destructLexErrorInfo(){var rec=!!this.recoverable;for(var key in this){if(this.hasOwnProperty(key)&&typeof key==="object"){this[key]=undefined}}this.recoverable=rec}};this.__error_infos.push(pei);return pei},parseError:function lexer_parseError(str,hash){if(this.yy.parser&&typeof this.yy.parser.parseError==="function"){return this.yy.parser.parseError(str,hash)||this.ERROR}else if(typeof this.yy.parseError==="function"){return this.yy.parseError.call(this,str,hash)||this.ERROR}else{throw new this.JisonLexerError(str)}},cleanupAfterLex:function lexer_cleanupAfterLex(do_not_nuke_errorinfos){var rv;this.setInput("",{});if(!do_not_nuke_errorinfos){for(var i=this.__error_infos.length-1;i>=0;i--){var el=this.__error_infos[i];if(el&&typeof el.destroy==="function"){el.destroy()}}this.__error_infos.length=0}return this},clear:function lexer_clear(){this.yytext="";this.yyleng=0;this.match="";this.matches=false;this._more=false;this._backtrack=false},setInput:function lexer_setInput(input,yy){this.yy=yy||this.yy||{};if(!this.__decompressed){var rules=this.rules;for(var i=0,len=rules.length;i<len;i++){var rule_re=rules[i];if(typeof rule_re==="number"){rules[i]=rules[rule_re]}}var conditions=this.conditions;for(var k in conditions){var spec=conditions[k];var rule_ids=spec.rules;var len=rule_ids.length;var rule_regexes=new Array(len+1);var rule_new_ids=new Array(len+1);if(this.rules_prefix1){var rule_prefixes=new Array(65536);var first_catch_all_index=0;for(var i=0;i<len;i++){var idx=rule_ids[i];var rule_re=rules[idx];rule_regexes[i+1]=rule_re;rule_new_ids[i+1]=idx;var prefix=this.rules_prefix1[idx];if(typeof prefix==="number"){prefix=this.rules_prefix1[prefix]}if(!prefix){if(!first_catch_all_index){first_catch_all_index=i+1}}else{for(var j=0,pfxlen=prefix.length;j<pfxlen;j++){var pfxch=prefix.charCodeAt(j);if(!rule_prefixes[pfxch]){rule_prefixes[pfxch]=i+1}}}}if(!first_catch_all_index){first_catch_all_index=len+1}for(var i=0;i<65536;i++){if(!rule_prefixes[i]){rule_prefixes[i]=first_catch_all_index}}spec.__dispatch_lut=rule_prefixes}else{for(var i=0;i<len;i++){var idx=rule_ids[i];var rule_re=rules[idx];rule_regexes[i+1]=rule_re;rule_new_ids[i+1]=idx}}spec.rules=rule_new_ids;spec.__rule_regexes=rule_regexes;spec.__rule_count=len}this.__decompressed=true}this._input=input||"";this.clear();this._signaled_error_token=false;this.done=false;this.yylineno=0;this.matched="";this.conditionStack=["INITIAL"];this.__currentRuleSet__=null;this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};if(this.options.ranges){this.yylloc.range=[0,0]}this.offset=0;return this},input:function lexer_input(){if(!this._input){return null}var ch=this._input[0];this.yytext+=ch;this.yyleng++;this.offset++;this.match+=ch;this.matched+=ch;var slice_len=1;var lines=false;if(ch==="\n"){lines=true}else if(ch==="\r"){lines=true;var ch2=this._input[1];if(ch2==="\n"){slice_len++;ch+=ch2;this.yytext+=ch2;this.yyleng++;this.offset++;this.match+=ch2;this.matched+=ch2;if(this.options.ranges){this.yylloc.range[1]++}}}if(lines){this.yylineno++;this.yylloc.last_line++}else{this.yylloc.last_column++}if(this.options.ranges){this.yylloc.range[1]++}this._input=this._input.slice(slice_len);return ch},unput:function lexer_unput(ch){var len=ch.length;var lines=ch.split(/(?:\r\n?|\n)/g);this._input=ch+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-len);this.offset-=len;var oldLines=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-len);this.matched=this.matched.substr(0,this.matched.length-len);if(lines.length-1){this.yylineno-=lines.length-1}this.yylloc.last_line=this.yylineno+1;this.yylloc.last_column=lines?(lines.length===oldLines.length?this.yylloc.first_column:0)+oldLines[oldLines.length-lines.length].length-lines[0].length:this.yylloc.first_column-len;if(this.options.ranges){this.yylloc.range[1]=this.yylloc.range[0]+this.yyleng-len}this.yyleng=this.yytext.length;this.done=false;return this},more:function lexer_more(){this._more=true;return this},reject:function lexer_reject(){if(this.options.backtrack_lexer){this._backtrack=true}else{var p=this.constructLexErrorInfo("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),false);this._signaled_error_token=this.parseError(p.errStr,p)||this.ERROR}return this},less:function lexer_less(n){return this.unput(this.match.slice(n))},pastInput:function lexer_pastInput(maxSize,maxLines){var past=this.matched.substring(0,this.matched.length-this.match.length);if(maxSize<0)maxSize=past.length;else if(!maxSize)maxSize=20;if(maxLines<0)maxLines=past.length;else if(!maxLines)maxLines=1;past=past.substr(-maxSize*2-2);var a=past.replace(/\r\n|\r/g,"\n").split("\n");a=a.slice(-maxLines);past=a.join("\n");if(past.length>maxSize){past="..."+past.substr(-maxSize)}return past},upcomingInput:function lexer_upcomingInput(maxSize,maxLines){var next=this.match;if(maxSize<0)maxSize=next.length+this._input.length;else if(!maxSize)maxSize=20;if(maxLines<0)maxLines=maxSize;else if(!maxLines)maxLines=1;if(next.length<maxSize*2+2){next+=this._input.substring(0,maxSize*2+2)}var a=next.replace(/\r\n|\r/g,"\n").split("\n");a=a.slice(0,maxLines);next=a.join("\n");if(next.length>maxSize){next=next.substring(0,maxSize)+"..."}return next},showPosition:function lexer_showPosition(maxPrefix,maxPostfix){var pre=this.pastInput(maxPrefix).replace(/\s/g," ");var c=new Array(pre.length+1).join("-");return pre+this.upcomingInput(maxPostfix).replace(/\s/g," ")+"\n"+c+"^"},describeYYLLOC:function lexer_describe_yylloc(yylloc,display_range_too){var l1=yylloc.first_line;var l2=yylloc.last_line;var o1=yylloc.first_column;var o2=yylloc.last_column-1;var dl=l2-l1;var d_o=dl===0?o2-o1:1e3;var rv;if(dl===0){rv="line "+l1+", ";if(d_o===0){rv+="column "+o1}else{rv+="columns "+o1+" .. "+o2}}else{rv="lines "+l1+"(column "+o1+") .. "+l2+"(column "+o2+")"}if(yylloc.range&&display_range_too){var r1=yylloc.range[0];var r2=yylloc.range[1]-1;if(r2===r1){rv+=" {String Offset: "+r1+"}"}else{rv+=" {String Offset range: "+r1+" .. "+r2+"}"}}return rv},test_match:function lexer_test_match(match,indexed_rule){var token,lines,backup,match_str;if(this.options.backtrack_lexer){backup={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done};if(this.options.ranges){backup.yylloc.range=this.yylloc.range.slice(0)}}match_str=match[0];lines=match_str.match(/(?:\r\n?|\n).*/g);if(lines){this.yylineno+=lines.length}this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:lines?lines[lines.length-1].length-lines[lines.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+match_str.length};this.yytext+=match_str;this.match+=match_str;this.matches=match;this.yyleng=this.yytext.length;if(this.options.ranges){this.yylloc.range=[this.offset,this.offset+this.yyleng]}this.offset+=match_str.length;this._more=false;this._backtrack=false;this._input=this._input.slice(match_str.length);this.matched+=match_str;token=this.performAction.call(this,this.yy,this,indexed_rule,this.conditionStack[this.conditionStack.length-1]);if(this.done&&this._input){this.done=false}if(token){return token}else if(this._backtrack){for(var k in backup){this[k]=backup[k]}this.__currentRuleSet__=null;return false}else if(this._signaled_error_token){token=this._signaled_error_token;this._signaled_error_token=false;return token}return false},next:function lexer_next(){if(this.done){this.clear();return this.EOF}if(!this._input){this.done=true}var token,match,tempMatch,index;if(!this._more){this.clear()}var spec=this.__currentRuleSet__;if(!spec){spec=this.__currentRuleSet__=this._currentRules()}var rule_ids=spec.rules;var regexes=spec.__rule_regexes;var len=spec.__rule_count;for(var i=1;i<=len;i++){tempMatch=this._input.match(regexes[i]);if(tempMatch&&(!match||tempMatch[0].length>match[0].length)){match=tempMatch;index=i;if(this.options.backtrack_lexer){token=this.test_match(tempMatch,rule_ids[i]);if(token!==false){return token}else if(this._backtrack){match=undefined;continue}else{return false}}else if(!this.options.flex){break}}}if(match){token=this.test_match(match,rule_ids[index]);if(token!==false){return token}return false}if(this._input===""){this.done=true;return this.EOF}else{var p=this.constructLexErrorInfo("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),this.options.lexer_errors_are_recoverable);token=this.parseError(p.errStr,p)||this.ERROR;if(token===this.ERROR){if(!this.match.length){this.input()}}return token}},lex:function lexer_lex(){var r;if(typeof this.options.pre_lex==="function"){r=this.options.pre_lex.call(this)}while(!r){r=this.next()}if(typeof this.options.post_lex==="function"){r=this.options.post_lex.call(this,r)||r}return r},begin:function lexer_begin(condition){return this.pushState(condition)},pushState:function lexer_pushState(condition){this.conditionStack.push(condition);this.__currentRuleSet__=null;return this},popState:function lexer_popState(){var n=this.conditionStack.length-1;if(n>0){this.__currentRuleSet__=null;return this.conditionStack.pop()}else{return this.conditionStack[0]}},topState:function lexer_topState(n){n=this.conditionStack.length-1-Math.abs(n||0);if(n>=0){return this.conditionStack[n]}else{return"INITIAL"}},_currentRules:function lexer__currentRules(){if(this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]){return this.conditions[this.conditionStack[this.conditionStack.length-1]]}else{return this.conditions["INITIAL"]}},stateStackSize:function lexer_stateStackSize(){return this.conditionStack.length},options:{},JisonLexerError:JisonLexerError,performAction:function lexer__performAction(yy,yy_,$avoiding_name_collisions,YY_START){var YYSTATE=YY_START;switch($avoiding_name_collisions){case 0:break;case 23:yy_.yytext=yy_.yytext.substr(1,yy_.yyleng-2);return 23;break;default:return this.simpleCaseActionClusters[$avoiding_name_collisions]}},simpleCaseActionClusters:{1:22,2:16,3:17,4:18,5:19,6:20,7:21,8:7,9:8,10:15,11:14,12:9,13:10,14:11,15:12,16:24,17:25,18:3,19:13,20:4,21:5,22:6,24:26,25:1,26:"INVALID"},rules:[/^(?:\s+)/,/^(?:(-)?\d+(\.\d+)?\b)/,/^(?:\|\|)/,/^(?:&&)/,/^(?:==)/,/^(?:!=)/,/^(?:<=)/,/^(?:>=)/,/^(?:<)/,/^(?:>)/,/^(?:\+\+)/,/^(?:--)/,/^(?:\+)/,/^(?:!)/,/^(?:\()/,/^(?:\))/,/^(?:true)/,/^(?:false)/,/^(?:,)/,/^(?:\.)/,/^(?:\[)/,/^(?:\])/,/^(?::)/,/^(?:(("(?:([^\n\r"\\]+)|(\\(?:(?:(?:["'\\bfnrtv])|(?:[^\d"'\\bfnrt-vx]))|(?:(?:[1-7][0-7]{0,2}|[0-7]{2,3}))|(?:[x]{HexDigit}{2})|(?:[u]{HexDigit}{4})))|(?:\\(\r\n|\r|\n)))*")|('(?:([^\n\r'\\]+)|(\\(?:(?:(?:["'\\bfnrtv])|(?:[^\d"'\\bfnrt-vx]))|(?:(?:[1-7][0-7]{0,2}|[0-7]{2,3}))|(?:[x]{HexDigit}{2})|(?:[u]{HexDigit}{4})))|(?:\\(\r\n|\r|\n)))*')))/,/^(?:((?:[$A-Z_a-z])(?:(?:[$A-Z_a-z])|\d)*))/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26],inclusive:true}}};return lexer}();parser.lexer=lexer;function Parser(){this.yy={}}Parser.prototype=parser;parser.Parser=Parser;return new Parser}();if(typeof require!=="undefined"&&typeof exports!=="undefined"){exports.parser=parser;exports.Parser=parser.Parser;exports.parse=function(){return parser.parse.apply(parser,arguments)}}},{}],2:[function(require,module,exports){"use strict";var attrs=["if","alias","text","html","repeat","import","attr","class","global"];var BB_IF=0,BB_ALIAS=1,BB_TEXT=2,BB_HTML=3,BB_REPEAT=4,BB_IMPORT=5,BB_ATTR=6,BB_CLASS=7,BB_GLOBAL=8;var TEMPLATE="TEMPLATE";var context={stack:[]};context.resolve=function(identifier){var m=this.stack.length-1;var value;while(value===undefined&&m>=0){value=this.stack[m][identifier];m--}return value===undefined?window[identifier]:value};context.init=function(arr){this.stack=arr||[]};context.push=function(obj){this.stack.push(obj)};context.pop=function(){return this.stack.pop()};function bbObj(a,b){this.value=a;this.name=b}bbObj.prototype.toString=function(){if(this.value&&this.name!=null)return this.name.toString();else return""};var Parser=require("../parser.js");Parser.parser.yy.context=context;Parser.parser.yy.bbObj=bbObj;function Barbiche(_opt){var opt=_opt||{};var doc=opt.document||document;var destructive=opt.destructive!==undefined?!!opt.destructive:true;var prefixedAttrs=attrs.map(function(str){return(opt.prefix||"bb-")+str});var prefixedAttrsObj={};prefixedAttrs.forEach(function(attr,index){prefixedAttrsObj[attr]=attrs[index]});var globalAttr=prefixedAttrs[BB_GLOBAL];var globalAttrSel="["+globalAttr+"]";function createTemplate(){return doc.createElement("template")}var store={};var compile_works={};compile_works[Node.ELEMENT_NODE]=function(node,template){if(node.hasAttribute(prefixedAttrs[BB_REPEAT])&&node.nodeName!=TEMPLATE){if(node.hasAttribute(prefixedAttrs[BB_TEXT])||node.hasAttribute(prefixedAttrs[BB_HTML]))node.removeAttribute(prefixedAttrs[BB_REPEAT]);else{var wrapper=createTemplate();wrapper.setAttribute(prefixedAttrs[BB_REPEAT],node.getAttribute(prefixedAttrs[BB_REPEAT]));node.removeAttribute(prefixedAttrs[BB_REPEAT]);[prefixedAttrs[BB_IF],prefixedAttrs[BB_ALIAS]].forEach(function(attr){if(node.hasAttribute(attr)){wrapper.setAttribute(attr,node.getAttribute(attr));node.removeAttribute(attr)}});node.before(wrapper);wrapper.content.appendChild(node);node=wrapper}}var bbAttrs={};var attrFound=false;if(node.attributes.length>attrs.length){prefixedAttrs.forEach(function(attr){if(node.hasAttribute(attr)){attrFound=true;var parsed=Parser.parse(node.getAttribute(attr));bbAttrs[prefixedAttrsObj[attr]]=template._addClosure(parsed);node.removeAttribute(attr)}})}else{for(var i=node.attributes.length-1;i>=0;i--){var attr=node.attributes[i].name;if(attr in prefixedAttrsObj){attrFound=true;var parsed=Parser.parse(node.attributes[i].value);bbAttrs[prefixedAttrsObj[attr]]=template._addClosure(parsed);node.removeAttribute(attr)}}}if(attrFound)node.setAttribute(globalAttr,JSON.stringify(bbAttrs));if(node.nodeName==TEMPLATE){compile(node.content,template);if(!attrFound)node.replaceWith(node.content)}else{Array.from(node.childNodes).forEach(function(child){compile(child,template)})}};compile_works[Node.TEXT_NODE]=function(){var delimiters=opt.delimiters||["{","}"];function regExpEscape(str){return str.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}var UnescapeDelimitersRegExp=new RegExp("\\\\("+["\\\\",regExpEscape(delimiters[0]),regExpEscape(delimiters[1])].join("|")+")","g");function unescapeDelimiters(str){return str.replace(UnescapeDelimitersRegExp,function(){return arguments[1]})}var regExpTemplate=["aaa((?:a+f+c+d+e+b(?:a+f+c+d+e+b(?:a+f+c+d+e)))*)bbb","aa((?:a+f+c+d+e+b(?:a+f+c+d+e))*)bb","((?:b+f+c+d+e+a(?:b+f+c+d+e))(?:b+f+c+d+e+a(?:b+f+c+d+e))*(?:a(?!a)+b+f+c+d+e++a(?:b+f+c+d+e))+(?:a(?!a)))"];var table={a:regExpEscape(delimiters[0]),b:regExpEscape(delimiters[1]),c:regExpEscape("\\"+delimiters[0]),d:regExpEscape("\\"+delimiters[1]),e:"[^"+regExpEscape(delimiters[0])+regExpEscape(delimiters[1])+"]"};var textNodeRegExp=new RegExp(regExpTemplate.map(function(str){return"(?:"+str.replace(/\+/g,"|").replace(/a|b|c|d|e/g,function(){return table[arguments[0]]})+")"}).join("|"),"g");return function(node,template){var res;while(res=textNodeRegExp.exec(node.nodeValue)){if(res[3]){var t=doc.createTextNode(unescapeDelimiters(res[3]));node.before(t)}else if(res[2]){var t=createTemplate();t.setAttribute(prefixedAttrs[BB_TEXT],unescapeDelimiters(res[2]));node.before(t);compile(t,template)}else{var t=createTemplate();t.setAttribute(prefixedAttrs[BB_HTML],unescapeDelimiters(res[1]));node.before(t);compile(t,template)}}node.remove()}}();compile_works[Node.COMMENT_NODE]=function(node,template){};
compile_works[Node.DOCUMENT_FRAGMENT_NODE]=function(node,template){Array.from(node.childNodes).forEach(function(child){compile(child,template)})};function compile(node,template){compile_works[node.nodeType](node,template)}var works={};works[Node.ELEMENT_NODE]=function(node,template){var nodeContext={};var nodeContextPushed=false;var bbAttrs=JSON.parse(node.getAttribute(globalAttr));node.removeAttribute(globalAttr);if(bbAttrs.if){var value=template.closures[bbAttrs.if]();if(!value)return node.remove()}if(bbAttrs.alias){var parsed=template.closures[bbAttrs.alias]();if(!Array.isArray(parsed))parsed=[parsed];parsed.forEach(function(item){nodeContext[item.name]=item.value});context.push(nodeContext);nodeContextPushed=true}if(bbAttrs.text){var value=template.closures[bbAttrs.text]();if(value!=null)value=value.toString();if(value){node.replaceWith(value)}else node.remove()}else if(bbAttrs.html){var value=template.closures[bbAttrs.html]();if(value!=null)value=value.toString();if(value){var aux=createTemplate();aux.innerHTML=value;node.replaceWith(aux.content)}else node.remove()}else if(node.nodeName==TEMPLATE){if(bbAttrs.repeat){if(!nodeContextPushed){context.push(nodeContext);nodeContextPushed=true}var parsed=template.closures[bbAttrs.repeat]();var order=parsed._order||"before";if(!Array.isArray(parsed))parsed=[parsed];var reduceInit=function(str){var closure=template.closures[bbAttrs.import];if(closure)return function(){var clone=Template(closure())._clone();node[order](merge(clone.node.content,clone))};else return function(){node[order](merge(node.cloneNode(true).content,template))}}(bbAttrs.import);parsed.reduceRight(function(accu,task){var alias=task.name;var value=task.value;return function(){value.forEach(function(item,index){nodeContext[alias]=value[index];nodeContext["_"+alias+"_"]=index;accu()})}},reduceInit)()}else if(bbAttrs.import){var importId=template.closures[bbAttrs.import]();var clone=Template(importId)._clone();node.before(merge(clone.node.content,clone))}node.remove()}else{if(bbAttrs.attr){var parsed=template.closures[bbAttrs.attr]();if(!Array.isArray(parsed))parsed=[parsed];parsed.forEach(function(item){var value=item.value;var name=item.name&&item.name.toString();if(name&&value!=null)node.setAttribute(name,value)})}if(bbAttrs.class){var parsed=template.closures[bbAttrs.class]();if(!Array.isArray(parsed))parsed=[parsed];parsed.forEach(function(item){if(item!=null){var value=item.toString();if(value)node.classList.add(value)}})}var child;while(child=node.querySelector(globalAttrSel)){merge(child,template)}}if(nodeContextPushed)context.pop()};works[Node.DOCUMENT_FRAGMENT_NODE]=function(node,template){var child;while(child=node.querySelector(globalAttrSel)){merge(child,template)}};function merge(node,template){works[node.nodeType](node,template);return node}function Template(node){if(node instanceof bbObj){var name=node.name;if(store[name])return store[name];else{var t=createTemplate();t.innerHTML=node.value;if(name)t.id=name;node=t}}if(typeof node=="string"){if(store[node])return store[node];else node=doc.querySelector("#"+node)}if(!(this instanceof Template)){return new Template(node)}if(node){if(node.id)store[node.id]=this;this.closures={};this.node=destructive?node:node.cloneNode(true);this.ready=false}return this}Template.bbObj=bbObj;Template.clean=function(name){if(name)delete store[name];else{for(var key in store){delete store[key]}}};Template.prototype.merge=function(){var clone=this._clone();var args=new Array(arguments.length);for(var i=0;i<args.length;++i){args[i]=arguments[i]}context.init(args);merge(clone.node.content,clone);context.init();return clone.node.content};Template.prototype._addClosure=function(){var counter=0;return function(fun){counter++;var str="fun"+counter;this.closures[str]=fun;return str}}();Template.prototype._compile=function(){compile(this.node.content,this);this.ready=true;return this};Template.prototype._clone=function(){if(!this.ready)this._compile();var t=new Template;t.node=this.node.cloneNode(true);t.closures=this.closures;return t};return Template}module.exports=Barbiche},{"../parser.js":1}]},{},[2])(2)});
