<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
	<title>Barbiche - interactive demo</title>
	<link rel="stylesheet" type="text/css" href="css/semantic.min.css">
	<link rel="stylesheet" type="text/css" href="css/codemirror.css">
	<link rel="stylesheet" type="text/css" href="css/custom.css">
	<script type="text/javascript" src="js/polyfills.min.js"></script>
	<script type="text/javascript" src="js/barbiche.min.js"></script>
	<script type="text/javascript" src="js/editor.min.js"></script>
	<script>
	var examples = {
		basic: {
			template:
'<template id="basic">\n' +
'	<div bb-class="class" bb-attr="attribute.value: attribute.name">{{text}}</div>\n' +
'</template>',
			js:
'barbiche(\'basic\').merge({\n' +
'	class: "barbiche",\n' +
'	attribute: {name: "my-attr", value: "my-val"},\n' +
'	text: "Hello World!"\n' +
'});'
		},
		starter: {
			template:
'<template id="starter">\n' +
'	<div bb-alias="items[1].name: \'name\'" bb-class="customClass">\n' +
'		<div>{{name}}</div>\n' +
'		<ul bb-attr="my_replace(attrValue): \'attr-name\'">\n' +
'			<template bb-repeat="items: \'item\'">\n' +
'				<li bb-if="item.show" bb-class="[item.species || \'unknown\', (_item_ == 0): \'first\']">\n' +
'				{{item.name}} (index: {{_item_}})\n' +
'				</li>\n' +
'			</template>\n' +
'		</ul>\n' +
'		<span>{{item.join(\', \').toUpperCase()}}</span>\n' +
'		{{{some_html}}}\n' +
'	</div>\n' +
'</template>',
			js:
'barbiche(\'starter\').merge({\n' +
'	customClass: "my-class",\n' +
'	"items": [\n' +
'		{species: "hen", name: "Elsa", show: true},\n' +
'		{species: "cat", name: "Jacynthe", show: false},\n' +
'		{species: null, name: "Zaza", show: true}\n' +
'	],\n' +
'	item: ["hen", "cat", "dog", "spider"],\n' +
'	some_html: "<div><p>This is...</p><p>...some HTML.</p></div>",\n' +
'	my_replace: function(str) {return str.replace(/o/g, "O");},\n' +
'	attrValue: "lunchroom"\n' +
'});'
		},
		text: {
			template:
'<template id="text">\n' +
'	<div>\n' +
'		<span>{{yes}}</span>\n' +
'		<span>{{(2 == 1 + 1): again}}</span>\n' +
'		<span>{{(1 == 4): no}}</span>\n' +
'		<span>{{Math.random() > 0.5: maybe}}</span>\n' +
'	</div>\n' +
'</template>\n' +
'\n' +
'\n' +
'<template id="html">\n' +
'	<div>\n' +
'		<span>{{{some_html}}}</span>\n' +
'		<span>{{some_html}}</span>\n' +
'	</div>\n' +
'</template>',
			js:
'var obj = {\n' +
'	yes: "You see me",\n' +
'	again: "You see me too",\n' +
'	no: "You won\'t see me",\n' +
'	maybe: "Well, maybe...",\n' +
'	some_html: "<div><p>This is...</p><p>...some HTML.</p></div>"\n' +
'};\n' +
'barbiche(\'text\').merge(obj);\n' +
'barbiche(\'html\').merge(obj);'
		},
		loops: {
			template:
'<template id="loop">\n' +
'	<div>\n' +
'		<span bb-repeat="items: \'item\'">{{item.name}} ({{_item_}})</span>\n' +
'	</div>\n' +
'</template>\n' +
'\n' +
'<template id="desc_loop">\n' +
'	<div>\n' +
'		<span bb-repeat="items: \'item\' --">{{item.name}} ({{_item_}})</span>\n' +
'	</div>\n' +
'</template>\n' +
'\n' +
'<template id="table">\n' +
'	<table>\n' +
'		<tbody>\n' +
'			<tr bb-repeat="rows: \'row\'">\n' +
'				<td bb-repeat="row: \'cell\'">{{cell}}</td>\n' +
'			</tr>\n' +
'		</tbody>\n' +
'	</table>\n' +
'</template>\n' +
'\n' +
'<template id="nested">\n' +
'	<div>\n' +
'		<span bb-repeat="[arr1: \'item1\', arr2: \'item2\']">{{item1}}{{item2}}</span>\n' +
'	</div>\n' +
'</template>',
		js:
'var data = {\n' +
'	items: [\n' +
'		{species: "hen", name: "Elsa", show: true},\n' +
'		{species: "cat", name: "Jacynthe", show: false},\n' +
'		{species: null, name: "Zaza", show: true}\n' +
'	]\n' +
'};\n' +
'barbiche(\'loop\').merge(data);\n' +
'barbiche(\'desc_loop\').merge(data);\n' +
'barbiche(\'table\').merge({\n' +
'	rows: [\n' +
'		["A1", "B1", "C1"],\n' +
'		["A2", "B2", "C2"]\n' +
'	]\n' +
'});\n' +
'barbiche(\'nested\').merge({\n' +
'	arr1: ["A", "B"],\n' +
'	arr2: [1, 2, 3]\n' +
'});'
		},
		imports: {
			template:
'<template id="simple-subtemplate">\n' +
'	<div>\n' +
'		<template bb-import="\'sub\'"></template>\n' +
'	</div>\n' +
'</template>\n' +
'\n' +
'<template id="sub">\n' +
'	<span>I am a subtemplate!</span>\n' +
'</template>\n' +
'\n' +
'<template id="dynamic-subtemplate">\n' +
'	<div>\n' +
'		<template bb-repeat="items: \'item\'" bb-import="item.sub"></template>\n' +
'	</div>\n' +
'</template>\n' +
'\n' +
'<template id="sub1">\n' +
'	<span>I am subtemplate1! ({{item.name}})</span>\n' +
'</template>\n' +
'\n' +
'<template id="sub2">\n' +
'	<span>I am subtemplate2! ({{item.name}})</span>\n' +
'</template>\n' +
'\n' +
'<template id="recursive">\n' +
'	<template bb-if="children.length" bb-import="\'recursive-sub\'"></template>\n' +
'</template>\n' +
'\n' +
'<template id="recursive-sub">\n' +
'	<ul>\n' +
'		<li bb-repeat="children: \'child\'">{{child.name}}\n' +
'			<template bb-if="child.children" bb-alias="child.children: \'children\'" bb-import="\'recursive-sub\'"></template>\n' +
'		</li>\n' +
'	</ul>\n' +
'</template>',
	js:
'barbiche(\'simple-subtemplate\').merge();\n' +
'barbiche(\'dynamic-subtemplate\').merge({\n' +
'	items: [{name: \'item1\', sub: \'sub2\'}, {name: \'item2\', sub: \'sub1\'}]\n' +
'});\n' +
'barbiche(\'recursive\').merge({\n' +
'	children: [\n' +
'		{\n' +
'			name: "Solomon",\n' +
'			children: [\n' +
'				{\n' +
'					name : "Lexie",\n' +
'					children: [\n' +
'						{\n' +
'							name: "Shavon",\n' +
'							children: [\n' +
'								{\n' +
'									name : "Shirleen"\n' +
'								}, {\n' +
'									name : "Kathleen"\n' +
'								}\n' +
'							]\n' +
'						},\n' +
'						{\n' +
'							name: "Travis"\n' +
'						},\n' +
'						{\n' +
'							name: "Adele"\n' +
'						},\n' +
'						{\n' +
'							name: "Barney"\n' +
'						}\n' +
'					]\n' +
'				}, {\n' +
'					name : "Allie"\n' +
'				}\n' +
'			]\n' +
'		}, {\n' +
'			name: "Juliann",\n' +
'			children: [\n' +
'				{\n' +
'					name : "Guy"\n' +
'				}, {\n' +
'					name : "Yaeko"\n' +
'				}\n' +
'			]\n' +
'		}\n' +
'	]\n' +
'});'
		}
	};
	</script>
</head>
<body>
	<div class="page-wrap">
		<div id="header" class="ui fixed inverted massive menu">
			<div class="ui container">
				<a href="index.html" class="header item">
					Barbiche
				</a>
				<a href="demo.html" class="item active">Try it</a>
				<a href="documentation.html" class="item">Documentation</a>
				<a href="https://github.com/manubb/barbiche" class="item">Github repository</a>
				<a href="https://github.com/edasarl" class="item floated right">
					<div style="display:block;position:relative;width:74px;height:20px;background-color:#fff;margin-right:10px;">
						<div style="width:4px;height:4px;top:16px;left:0px;background-color:#000;display:block;position:absolute;"></div>
						<div style="width:10px;height:4px;top:4px;left:4px;background-color:#000;display:block;position:absolute;"></div>
						<div style="width:10px;height:4px;top:12px;left:4px;background-color:#000;display:block;position:absolute;"></div>
						<div style="width:4px;height:20px;top:0px;left:12px;background-color:#000;display:block;position:absolute;"></div>
						<div style="width:4px;height:12px;top:4px;left:20px;background-color:#000;display:block;position:absolute;"></div>
						<div style="width:12px;height:4px;top:0px;left:24px;background-color:#000;display:block;position:absolute;"></div>
						<div style="width:8px;height:4px;top:16px;left:24px;background-color:#000;display:block;position:absolute;"></div>
						<div style="width:4px;height:16px;top:4px;left:28px;background-color:#000;display:block;position:absolute;"></div>
						<div style="width:4px;height:8px;top:4px;left:36px;background-color:#000;display:block;position:absolute;"></div>
						<div style="width:4px;height:4px;top:16px;left:36px;background-color:#000;display:block;position:absolute;"></div>
						<div style="width:38px;height:4px;top:0px;left:40px;background-color:#000;display:block;position:absolute;"></div>
						<div style="width:30px;height:17px;top:3px;left:44px;background-color:#000;display:block;position:absolute;"></div>
					</div>
				</a>
			</div>
		</div>
		<div class="main">
			<div class="ui container margin-top-30">
				<h1 class="ui header">Choose an example, edit code (optional) and click process button</h1>
				<div id="buttons" class="ui segment">
					<h2 class="ui header">Examples</h2>
					<button name="basic" class="ui button">Basic</button>
					<button name="starter" class="ui button">Starter</button>
					<button name="text" class="ui button">Text/HTML</button>
					<button name="loops" class="ui button">Loops</button>
					<button name="imports" class="ui button">Imports</button>
				</div>
				<div class="ui segment">
					<h2 class="ui header">HTML</h2>
					<div id="template" class="ui segment"></div>
				</div>
				<div class="ui segment">
					<h2 class="ui header">JavaScript</h2>
					<div id="data" class="ui segment"></div>
				</div>
				<button id="process" class="fluid ui button">Process</button>
				<div id="result" class="ui segment hide"></div>
				<div id="temp"></div>
			</div>
		</div>
	</div>
	<div id="footer" class="ui inverted vertical footer segment">
		<div class="ui center aligned container">
			<div class="ui horizontal inverted large divided link list">
				<a class="item" href="index.html">Barbiche home</a>
				<a class="item" href="demo.html">Try it</a>
				<a class="item" href="documentation.html">Documentation</a>
				<a class="item" href="https://github.com/manubb/barbiche">Github repository</a>
			</div>
		</div>
	</div>
<script>
	var barbiche = Barbiche();
	document.addEventListener('DOMContentLoaded', function() {
		var temp = document.querySelector('#temp');
		var result = document.querySelector('#result');
		var resultCodeMirror = CodeMirror(result, {
			mode: "htmlmixed",
			readOnly: true,
			lineWrapping: true,
			tabSize: 2,
			indentWithTabs: true
		});
		var templateCodeMirror = CodeMirror(document.querySelector('#template'), {
			mode:  "htmlmixed",
			lineWrapping: true,
			tabSize: 2,
			indentWithTabs: true
		});
		var dataCodeMirror = CodeMirror(document.querySelector('#data'), {
			mode: "javascript",
			lineWrapping: true,
			tabSize: 2,
			indentWithTabs: true
		});
		var t;
		var pristineMerge = barbiche.prototype.merge;
		barbiche.prototype.merge = function() {
			var frag = pristineMerge.apply(this, arguments);
			t.content.appendChild(frag);
		};
		function showResult(str) {
			resultCodeMirror.setValue(str);
			setTimeout(function() {
				resultCodeMirror.refresh();
			});
		}
		document.querySelector('#process').addEventListener('click', function() {
			result.classList.remove('hide');
			barbiche.clean();
			t = document.createElement('template');
			temp.innerHTML = templateCodeMirror.getValue();
			window.HTMLTemplateElement.bootstrap && window.HTMLTemplateElement.bootstrap(temp);
			var content = dataCodeMirror.getValue();
			try {
				eval(content);
				showResult(html_beautify(t.innerHTML, {'preserve_newlines': false}));
			} catch(e) {showResult(e.name + ": " + e.message);}
		});
		function setExample(example) {
			if (example) {
				templateCodeMirror.setValue(example.template);
				dataCodeMirror.setValue(example.js);
				setTimeout(function() {
					dataCodeMirror.refresh();
					templateCodeMirror.refresh();
				});
				result.classList.add('hide');
			}
		}
		setExample(examples['basic']);
		document.querySelector('#buttons').addEventListener('click', function(e) {
			var target = e.target;
			if (target.classList.contains('button')) {
				setExample(examples[target.getAttribute('name')]);
			}
		});
	});
</script>
</body>
</html>
